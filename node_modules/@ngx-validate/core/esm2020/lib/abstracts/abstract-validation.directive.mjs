import { Directive, ElementRef, Input, } from '@angular/core';
import { merge, NEVER } from 'rxjs';
import { BLUEPRINTS } from '../constants';
import { VALIDATION_BLUEPRINTS, VALIDATION_ERROR_TEMPLATE, VALIDATION_INVALID_CLASSES, VALIDATION_MAP_ERRORS_FN, VALIDATION_TARGET_SELECTOR, VALIDATION_VALIDATE_ON_SUBMIT, } from '../tokens';
import { evalPropTruthy } from '../utils';
import * as i0 from "@angular/core";
export class AbstractValidationDirective {
    constructor(injector) {
        this.injector = injector;
        this.config = {
            blueprints: injector.get(VALIDATION_BLUEPRINTS),
            errorTemplate: injector.get(VALIDATION_ERROR_TEMPLATE),
            invalidClasses: injector.get(VALIDATION_INVALID_CLASSES),
            mapErrorsFn: injector.get(VALIDATION_MAP_ERRORS_FN),
            targetSelector: injector.get(VALIDATION_TARGET_SELECTOR),
            validateOnSubmit: injector.get(VALIDATION_VALIDATE_ON_SUBMIT),
        };
        this.elRef = injector.get(ElementRef);
    }
    get group() {
        return ((this.groupRef || {}).form ||
            (this.groupName || {}).control);
    }
    get parent() {
        return this.parentRef || { getStream: () => null };
    }
    get blueprints() {
        return {
            ...BLUEPRINTS,
            ...(this._blueprints || this.parent.blueprints || this.config.blueprints || {}),
        };
    }
    get errorTemplate() {
        return this._errorTemplate || this.parent.errorTemplate || this.config.errorTemplate;
    }
    get invalidClasses() {
        return this._invalidClasses || this.parent.invalidClasses || this.config.invalidClasses;
    }
    get mapErrorsFn() {
        return this._mapErrorsFn || this.parent.mapErrorsFn || this.config.mapErrorsFn;
    }
    get skipValidation() {
        return (evalPropTruthy(this._skipValidation) ||
            this.parent.skipValidation ||
            this.config.skipValidation);
    }
    get targetSelector() {
        return this._targetSelector || this.parent.targetSelector || this.config.targetSelector;
    }
    get validateOnSubmit() {
        return (evalPropTruthy(this._validateOnSubmit) ||
            this.parent.validateOnSubmit ||
            this.config.validateOnSubmit);
    }
    getStream(streamName) {
        return merge(this[streamName + '$']
            ? this[streamName + '$'].asObservable()
            : NEVER, this.parent.getStream(streamName) || NEVER);
    }
    ngOnDestroy() { }
}
AbstractValidationDirective.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "14.2.7", ngImport: i0, type: AbstractValidationDirective, deps: [{ token: i0.Injector }], target: i0.ɵɵFactoryTarget.Directive });
AbstractValidationDirective.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "14.0.0", version: "14.2.7", type: AbstractValidationDirective, selector: "abstractValidationDirective", inputs: { _blueprints: ["blueprints", "_blueprints"], _errorTemplate: ["errorTemplate", "_errorTemplate"], _invalidClasses: ["invalidClasses", "_invalidClasses"], _mapErrorsFn: ["mapErrorsFn", "_mapErrorsFn"], _skipValidation: ["skipValidation", "_skipValidation"], _targetSelector: ["targetSelector", "_targetSelector"], _validateOnSubmit: ["validateOnSubmit", "_validateOnSubmit"] }, ngImport: i0 });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "14.2.7", ngImport: i0, type: AbstractValidationDirective, decorators: [{
            type: Directive,
            args: [{
                    /* tslint:disable-next-line */
                    selector: 'abstractValidationDirective',
                }]
        }], ctorParameters: function () { return [{ type: i0.Injector }]; }, propDecorators: { _blueprints: [{
                type: Input,
                args: ['blueprints']
            }], _errorTemplate: [{
                type: Input,
                args: ['errorTemplate']
            }], _invalidClasses: [{
                type: Input,
                args: ['invalidClasses']
            }], _mapErrorsFn: [{
                type: Input,
                args: ['mapErrorsFn']
            }], _skipValidation: [{
                type: Input,
                args: ['skipValidation']
            }], _targetSelector: [{
                type: Input,
                args: ['targetSelector']
            }], _validateOnSubmit: [{
                type: Input,
                args: ['validateOnSubmit']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWJzdHJhY3QtdmFsaWRhdGlvbi5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wYWNrYWdlcy9jb3JlL3NyYy9saWIvYWJzdHJhY3RzL2Fic3RyYWN0LXZhbGlkYXRpb24uZGlyZWN0aXZlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTCxTQUFTLEVBQ1QsVUFBVSxFQUVWLEtBQUssR0FJTixNQUFNLGVBQWUsQ0FBQztBQUV2QixPQUFPLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBNkIsTUFBTSxNQUFNLENBQUM7QUFDL0QsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGNBQWMsQ0FBQztBQUcxQyxPQUFPLEVBQ0wscUJBQXFCLEVBQ3JCLHlCQUF5QixFQUN6QiwwQkFBMEIsRUFDMUIsd0JBQXdCLEVBQ3hCLDBCQUEwQixFQUMxQiw2QkFBNkIsR0FDOUIsTUFBTSxXQUFXLENBQUM7QUFDbkIsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLFVBQVUsQ0FBQzs7QUFNMUMsTUFBTSxPQUFPLDJCQUEyQjtJQTZFdEMsWUFBbUIsUUFBa0I7UUFBbEIsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUNuQyxJQUFJLENBQUMsTUFBTSxHQUFHO1lBQ1osVUFBVSxFQUFFLFFBQVEsQ0FBQyxHQUFHLENBQUMscUJBQXFCLENBQUM7WUFDL0MsYUFBYSxFQUFFLFFBQVEsQ0FBQyxHQUFHLENBQUMseUJBQXlCLENBQUM7WUFDdEQsY0FBYyxFQUFFLFFBQVEsQ0FBQyxHQUFHLENBQUMsMEJBQTBCLENBQUM7WUFDeEQsV0FBVyxFQUFFLFFBQVEsQ0FBQyxHQUFHLENBQUMsd0JBQXdCLENBQUM7WUFDbkQsY0FBYyxFQUFFLFFBQVEsQ0FBQyxHQUFHLENBQUMsMEJBQTBCLENBQUM7WUFDeEQsZ0JBQWdCLEVBQUUsUUFBUSxDQUFDLEdBQUcsQ0FBQyw2QkFBNkIsQ0FBQztTQUM5RCxDQUFDO1FBQ0YsSUFBSSxDQUFD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QjtnQkFJdkIsaUJBQWlCO3NCQURoQixLQUFLO3VCQUFDLGtCQUFrQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIERpcmVjdGl2ZSxcbiAgRWxlbWVudFJlZixcbiAgSW5qZWN0b3IsXG4gIElucHV0LFxuICBPbkRlc3Ryb3ksXG4gIFRlbXBsYXRlUmVmLFxuICBUeXBlLFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFVudHlwZWRGb3JtR3JvdXAsIEZvcm1Hcm91cERpcmVjdGl2ZSwgRm9ybUdyb3VwTmFtZSB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IG1lcmdlLCBORVZFUiwgT2JzZXJ2YWJsZSwgUmVwbGF5U3ViamVjdCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgQkxVRVBSSU5UUyB9IGZyb20gJy4uL2NvbnN0YW50cyc7XG5pbXBvcnQgeyBWYWxpZGF0aW9uR3JvdXBEaXJlY3RpdmUgfSBmcm9tICcuLi9kaXJlY3RpdmVzL3ZhbGlkYXRpb24tZ3JvdXAuZGlyZWN0aXZlJztcbmltcG9ydCB7IFZhbGlkYXRpb24gfSBmcm9tICcuLi9tb2RlbHMnO1xuaW1wb3J0IHtcbiAgVkFMSURBVElPTl9CTFVFUFJJTlRTLFxuICBWQUxJREFUSU9OX0VSUk9SX1RFTVBMQVRFLFxuICBWQUxJREFUSU9OX0lOVkFMSURfQ0xBU1NFUyxcbiAgVkFMSURBVElPTl9NQVBfRVJST1JTX0ZOLFxuICBWQUxJREFUSU9OX1RBUkdFVF9TRUxFQ1RPUixcbiAgVkFMSURBVElPTl9WQUxJREFURV9PTl9TVUJNSVQsXG59IGZyb20gJy4uL3Rva2Vucyc7XG5pbXBvcnQgeyBldmFsUHJvcFRydXRoeSB9IGZyb20gJy4uL3V0aWxzJztcblxuQERpcmVjdGl2ZSh7XG4gIC8qIHRzbGludDpkaXNhYmxlLW5leHQtbGluZSAqL1xuICBzZWxlY3RvcjogJ2Fic3RyYWN0VmFsaWRhdGlvbkRpcmVjdGl2ZScsXG59KVxuZXhwb3J0IGNsYXNzIEFic3RyYWN0VmFsaWRhdGlvbkRpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uRGVzdHJveSB7XG4gIEBJbnB1dCgnYmx1ZXByaW50cycpXG4gIF9ibHVlcHJpbnRzOiBWYWxpZGF0aW9uLkJsdWVwcmludHM7XG5cbiAgQElucHV0KCdlcnJvclRlbXBsYXRlJylcbiAgX2Vycm9yVGVtcGxhdGU6IFRlbXBsYXRlUmVmPGFueT4gfCBUeXBlPGFueT47XG5cbiAgQElucHV0KCdpbnZhbGlkQ2xhc3NlcycpXG4gIF9pbnZhbGlkQ2xhc3Nlczogc3RyaW5nO1xuXG4gIEBJbnB1dCgnbWFwRXJyb3JzRm4nKVxuICBfbWFwRXJyb3JzRm46IFZhbGlkYXRpb24uTWFwRXJyb3JzRm47XG5cbiAgQElucHV0KCdza2lwVmFsaWRhdGlvbicpXG4gIF9za2lwVmFsaWRhdGlvbjogYm9vbGVhbjtcblxuICBASW5wdXQoJ3RhcmdldFNlbGVjdG9yJylcbiAgX3RhcmdldFNlbGVjdG9yOiBzdHJpbmc7XG5cbiAgQElucHV0KCd2YWxpZGF0ZU9uU3VibWl0JylcbiAgX3ZhbGlkYXRlT25TdWJtaXQ6IGJvb2xlYW47XG5cbiAgZ2V0IGdyb3VwKCk6IFVudHlwZWRGb3JtR3JvdXAge1xuICAgIHJldHVybiAoXG4gICAgICAodGhpcy5ncm91cFJlZiB8fCAoe30gYXMgRm9ybUdyb3VwRGlyZWN0aXZlKSkuZm9ybSB8fFxuICAgICAgKHRoaXMuZ3JvdXBOYW1lIHx8ICh7fSBhcyBGb3JtR3JvdXBOYW1lKSkuY29udHJvbFxuICAgICk7XG4gIH1cblxuICBnZXQgcGFyZW50KCk6IFBhcnRpYWw8VmFsaWRhdGlvbkdyb3VwRGlyZWN0aXZlPiB7XG4gICAgcmV0dXJuIHRoaXMucGFyZW50UmVmIHx8IHsgZ2V0U3RyZWFtOiAoKSA9PiBudWxsIH07XG4gIH1cblxuICBnZXQgYmx1ZXByaW50cygpOiBWYWxpZGF0aW9uLkJsdWVwcmludHMge1xuICAgIHJldHVybiB7XG4gICAgICAuLi5CTFVFUFJJTlRTLFxuICAgICAgLi4uKHRoaXMuX2JsdWVwcmludHMgfHwgdGhpcy5wYXJlbnQuYmx1ZXByaW50cyB8fCB0aGlzLmNvbmZpZy5ibHVlcHJpbnRzIHx8IHt9KSxcbiAgICB9O1xuICB9XG5cbiAgZ2V0IGVycm9yVGVtcGxhdGUoKTogVGVtcGxhdGVSZWY8YW55PiB8IFR5cGU8YW55PiB7XG4gICAgcmV0dXJuIHRoaXMuX2Vycm9yVGVtcGxhdGUgfHwgdGhpcy5wYXJlbnQuZXJyb3JUZW1wbGF0ZSB8fCB0aGlzLmNvbmZpZy5lcnJvclRlbXBsYXRlO1xuICB9XG5cbiAgZ2V0IGludmFsaWRDbGFzc2VzKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMuX2ludmFsaWRDbGFzc2VzIHx8IHRoaXMucGFyZW50LmludmFsaWRDbGFzc2VzIHx8IHRoaXMuY29uZmlnLmludmFsaWRDbGFzc2VzO1xuICB9XG5cbiAgZ2V0IG1hcEVycm9yc0ZuKCk6IFZhbGlkYXRpb24uTWFwRXJyb3JzRm4ge1xuICAgIHJldHVybiB0aGlzLl9tYXBFcnJvcnNGbiB8fCB0aGlzLnBhcmVudC5tYXBFcnJvcnNGbiB8fCB0aGlzLmNvbmZpZy5tYXBFcnJvcnNGbjtcbiAgfVxuXG4gIGdldCBza2lwVmFsaWRhdGlvbigpOiBib29sZWFuIHtcbiAgICByZXR1cm4gKFxuICAgICAgZXZhbFByb3BUcnV0aHkodGhpcy5fc2tpcFZhbGlkYXRpb24pIHx8XG4gICAgICB0aGlzLnBhcmVudC5za2lwVmFsaWRhdGlvbiB8fFxuICAgICAgdGhpcy5jb25maWcuc2tpcFZhbGlkYXRpb25cbiAgICApO1xuICB9XG5cbiAgZ2V0IHRhcmdldFNlbGVjdG9yKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMuX3RhcmdldFNlbGVjdG9yIHx8IHRoaXMucGFyZW50LnRhcmdldFNlbGVjdG9yIHx8IHRoaXMuY29uZmlnLnRhcmdldFNlbGVjdG9yO1xuICB9XG5cbiAgZ2V0IHZhbGlkYXRlT25TdWJtaXQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIChcbiAgICAgIGV2YWxQcm9wVHJ1dGh5KHRoaXMuX3ZhbGlkYXRlT25TdWJtaXQpIHx8XG4gICAgICB0aGlzLnBhcmVudC52YWxpZGF0ZU9uU3VibWl0IHx8XG4gICAgICB0aGlzLmNvbmZpZy52YWxpZGF0ZU9uU3VibWl0XG4gICAgKTtcbiAgfVxuXG4gIGNvbmZpZzogVmFsaWRhdGlvbi5Db25maWc7XG4gIGVsUmVmOiBFbGVtZW50UmVmO1xuICBncm91cE5hbWU6IEZvcm1Hcm91cE5hbWU7XG4gIGdyb3VwUmVmOiBGb3JtR3JvdXBEaXJlY3RpdmU7XG4gIHBhcmVudFJlZjogVmFsaWRhdGlvbkdyb3VwRGlyZWN0aXZlO1xuICBjb25zdHJ1Y3RvcihwdWJsaWMgaW5qZWN0b3I6IEluamVjdG9yKSB7XG4gICAgdGhpcy5jb25maWcgPSB7XG4gICAgICBibHVlcHJpbnRzOiBpbmplY3Rvci5nZXQoVkFMSURBVElPTl9CTFVFUFJJTlRTKSxcbiAgICAgIGVycm9yVGVtcGxhdGU6IGluamVjdG9yLmdldChWQUxJREFUSU9OX0VSUk9SX1RFTVBMQVRFKSxcbiAgICAgIGludmFsaWRDbGFzc2VzOiBpbmplY3Rvci5nZXQoVkFMSURBVElPTl9JTlZBTElEX0NMQVNTRVMpLFxuICAgICAgbWFwRXJyb3JzRm46IGluamVjdG9yLmdldChWQUxJREFUSU9OX01BUF9FUlJPUlNfRk4pLFxuICAgICAgdGFyZ2V0U2VsZWN0b3I6IGluamVjdG9yLmdldChWQUxJREFUSU9OX1RBUkdFVF9TRUxFQ1RPUiksXG4gICAgICB2YWxpZGF0ZU9uU3VibWl0OiBpbmplY3Rvci5nZXQoVkFMSURBVElPTl9WQUxJREFURV9PTl9TVUJNSVQpLFxuICAgIH07XG4gICAgdGhpcy5lbFJlZiA9IGluamVjdG9yLmdldChFbGVtZW50UmVmKTtcbiAgfVxuXG4gIGdldFN0cmVhbShzdHJlYW1OYW1lOiBWYWxpZGF0aW9uLlN0cmVhbU5hbWUpOiBPYnNlcnZhYmxlPFVudHlwZWRGb3JtR3JvdXA+IHtcbiAgICByZXR1cm4gbWVyZ2UoXG4gICAgICB0aGlzW3N0cmVhbU5hbWUgKyAnJCddXG4gICAgICAgID8gKHRoaXNbc3RyZWFtTmFtZSArICckJ10gYXMgUmVwbGF5U3ViamVjdDxVbnR5cGVkRm9ybUdyb3VwPikuYXNPYnNlcnZhYmxlKClcbiAgICAgICAgOiBORVZFUixcbiAgICAgIHRoaXMucGFyZW50LmdldFN0cmVhbShzdHJlYW1OYW1lKSB8fCBORVZFUixcbiAgICApO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7fVxufVxuIl19